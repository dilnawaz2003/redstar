

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  
} 



model User {
  id           String    @id @default(cuid())
  name         String
  email        String    @unique
  password     String
  createdAt    DateTime  @default(now()) @map("created_at")
  
  createdWorkspaces Workspace[] @relation("WorkspaceCreator")
  workspaceMembers  WorkspaceMember[]
  assignedTasks     Task[] @relation("TaskAssignee")
  activityLogs      ActivityLog[]
  
  @@map("users")
}

model Workspace {
  id          String    @id @default(cuid())
  name        String
  createdById String    @map("created_by")
  createdAt   DateTime  @default(now()) @map("created_at")
  
  creator     User      @relation("WorkspaceCreator", fields: [createdById], references: [id])
  members     WorkspaceMember[]
  projects    Project[]
  
  @@map("workspaces")
}

model WorkspaceMember {
  id          String    @id @default(cuid())
  workspaceId String    @map("workspace_id")
  userId      String    @map("user_id")
  role        String    @default("member") // 'owner', 'admin', 'member'
  
  workspace   Workspace @relation(fields: [workspaceId], references: [id])
  user        User      @relation(fields: [userId], references: [id])
  
  @@unique([workspaceId, userId])
  @@map("workspace_members")
}

model Project {
  id          String    @id @default(cuid())
  workspaceId String    @map("workspace_id")
  name        String
  description String?
  createdAt   DateTime  @default(now()) @map("created_at")
  
  workspace   Workspace @relation(fields: [workspaceId], references: [id])
  tasks       Task[]
  
  @@map("projects")
}

model Task {
  id          String    @id @default(cuid())
  projectId   String    @map("project_id")
  title       String
  description String?
  status      String    @default("todo") // 'todo', 'in_progress', 'review', 'done'
  priority    String    @default("medium") // 'low', 'medium', 'high', 'urgent'
  dueDate     DateTime? @map("due_date")
  assignedTo  String?   @map("assigned_to")
  createdAt   DateTime  @default(now()) @map("created_at")
  
  project     Project   @relation(fields: [projectId], references: [id])
  assignee    User?     @relation("TaskAssignee", fields: [assignedTo], references: [id])
  activityLogs ActivityLog[]
  
  @@map("tasks")
}

model ActivityLog {
  id          String    @id @default(cuid())
  taskId      String    @map("task_id")
  userId      String    @map("user_id")
  action      String    // 'created', 'updated', 'status_changed', 'assigned', etc.
  details     Json?     // Store change details
  createdAt   DateTime  @default(now()) @map("created_at")
  
  task        Task      @relation(fields: [taskId], references: [id])
  user        User      @relation(fields: [userId], references: [id])
  
  @@map("activity_logs")
}
